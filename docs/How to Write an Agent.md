# How to Write an Agent

## Introduction

An agent in the Sirji framework is a modular AI component designed to perform specific task based on custom pseudocode.

Think of the custom agent as a new team member. You need to provide it with your understanding of the existing architecture, design patterns, and code conventions used in the repository where you plan to use the custom agent to solve a problem. This understanding is conveyed through the agent's pseudocode.

This guide will explain the terminology involved, provide example pseudocode snippets for various use cases, and outline best practices for writing pseudocode.

[Here](../sirji/vscode-extension/src/defaults/agents/NODE_JS_CREATE_API_PLANNER.yml) is an example of an agent pseudocode.

[Here](https://www.youtube.com/watch?v=8rtZdN9-5UY) is a YouTube video covering agents and recipes.

## Terminology

- **SIRJI_USER**: The developer using Sirji.
- **Agent**: A modular AI component in the Sirji framework that performs a specific task based on custom pseudocode.
- **Sub Agent**: An agent can optionally invoke other agents for performing a sub-task. These other agents are called sub-agents. 
- **Recipe**: A file listing prescribed tasks for solving a particular problem, indicating which agent should perform each task.
- **Project Folder**: The primary directory for all user-specific project files, including code files, documentation, and other relevant resources.
- **Agent Output Folder**: The designated folder for storing the results and data outputs generated by the agents.

## Agent YML
The agent pseudocode is written in a YML file. [Here](../sirji/vscode-extension/src/defaults/agents/NODE_JS_CREATE_API_PLANNER.yml) is an example agent YML file.

This YML file has these mandatory fields:
- **id**: Uppercased unique identified for the agent.
- **name**: Human readable name of the agent.
- **llm**: This key maps to an object with these keys:
   - **provider**: Specifies which company's model will be used for inference. Possible values: openai, anthropic and deepseek.
   - **model**: Specifies the model to be used for inference. Possible values: gpt-4o, deepseek-coder, etc.
- **sub_agents**: Optional list of sub_agent objects each having these keys:
   - **id**: ID of the sub agent.
- **skill**: Specifies the skill of the agent.
- **pseudo_code**: Specifies the point-wise pseudo-code which the agent follows to work on the task.

## Pseudocode Use Cases

In this section, we will go over different use cases encountered while writing pseudocode, providing example pseudocode snippets.

### Interact with User

#### Ask question to User

Example pseudocode step:

```
Ask SIRJI_USER to provide {{Write the question here}}.
```

### RAG Assistant

You can create a RAG assistant to facilitate in embeddings powered search over the project files.

#### Creare Assistant

In a single Sirji run, only one RAG assistant can be created and the same gets re-used over the entire run.

Example pseudocode step:

```
Create an assistant with the following instructions:
{{Write the instructions here}}
```

#### Syncing Project Files with the Assistant

Example pseudocode step:

```
Sync project files with the assistant.
```

#### Querying the Assistant

Example pseudocode step:

```
Infer from the assistant with the following query:
{{Write the query here}}
```

### Project folder Operation

#### Read Files

Example pseudocode step:

```
Using the project folder structure, determine the file paths for the following core codebase files and read them for the specified purposes:
    - OpenAPI file: Understand the input parameter and response specifications for the API.
    - Sequence diagram relevant to the Target API: Understand the logic to be implemented.
```

#### Create a File

Example pseudocode step:

```
Under the services folder in the project, create a service file for the API, following the conventions used in the inspiration service file.
```

#### Update a File

Example pseudocode step:

```
Change the version in setup.py to 3.0.0.
```

### Agent Output Folder Operations

#### Read a File

Example pseudocode step:

```
Read the problem statement from the Agent Output Folder.
```

#### Create a File

Example pseudocode step:

```
Store the problem statement in the Agent Output Folder.
```

### Invoke Other Agents

An agent can be invoked in a fresh session or an existing session. If invoked in an existing session the agent continues on the earlier conversation which it already had with the LLM. When invoked in a fresh session, a fresh LLM conversation is started.

#### Fresh Session

Example pseudocode step:

```
Invoke agent NODE_JS_CREATE_API_PLANNER to {{write the purpose of invocation here}}.
```

#### Existing Session

Example pseudocode step:

```
Invoke agent NODE_JS_CREATE_API_PLANNER in the existing session to {{write the purpose of invocation here}}.
```

### Terminal Operations

#### Run a Command

Example pseudocode step:

```
Run `npm install`
```

#### Start a Server Process

Example pseudocode step:

```
Start the server using command: `npm start`
```

### Misc

#### Write to Scratchpad

Scratchpad is a personal note taking place for the agent. You can ask the agent to store it's understanding, etc over here.

Example pseudocode step:

```
Understand the code conventions followed in the existing code which you have read and store your understanding in the scratchpad.
```

## Best Practices

Follow these best practices when writing agent pseudocode:

- **Ask Questions Early:** As much as possible, ask questions to SIRJI_USER at the beginning to prevent unnecessary messages in the conversation, which can reduce costs.
- **Read Files Efficiently:** Read multiple files in one go to minimize redundant file content being sent in API calls, leading to lower costs.
- **Structure Clearly:** Have a clear structure for the pseudocode to improve understanding and ease of editing.
- **Define Terms Clearly:** Define terms clearly for easy reference later in the pseudocode. Use phrases like "Let's call this ..." to establish terminology.
- **Break Large Problem into Small Steps:** Proceed incrementally when writing pseudo code. This allows LLM to perform small tasks sequentially instead of one complex task in one go. It is best to break your problem into several small steps.
- **Ensure Use Case Alignment:** Ensure that each point in the agent pseudocode corresponds to one and only one of the pseudocode use cases mentioned above.
- **Use Scratchpad to Remember LLM's Understanding** Wherever you want the LLM to remember its understanding of the step you should explicitly ask it to save it in the scratchpad.
